<%- include('../header'); -%>
<%- include('../sidebar'); -%>
<!-- Page Content  -->
<div class="app-main__inner">
    <div class="app-page-title">
        <div class="page-title-wrapper">
            <div class="page-title-heading">
                <div class="page-title-icon">
                    <i class="pe-7s-car icon-gradient bg-mean-fruit"></i>
                </div>
                <div>
                   View Details
                </div>
            </div>
            <div class="page-title-actions">
                <% if(!user.isBlocked){ %>
                 <div class="d-inline-block dropdown pr-3">
                     <button id = "<%= user._id %>" class="btn-shadow 
                      btn btn-danger">
                         <span class="btn-icon-wrapper pr-2 opacity-7">
                             <i class="fa fa-business-time fa-w-20"></i>
                         </span>
                         Block user
                        </button>
                 </div>
                <% }else{ %>
                    <div class="d-inline-block dropdown pr-3">
                        <button id = "<%= user._id %>" class="btn-shadow 
                         btn btn-info">
                            <span class="btn-icon-wrapper pr-2 opacity-7">
                                <i class="fa fa-business-time fa-w-20"></i>
                            </span>
                            Unblock user
                        </button>
                    </div>
                <% } %>
                 <div class="d-inline-block dropdown">
                    <a type="button" href="/admin/send-message/<%= user._id %>" class="btn-shadow 
                     btn btn-primary">
                        <span class="btn-icon-wrapper pr-2 opacity-7">
                            <i class="fa fa-business-time fa-w-20"></i>
                        </span>
                        Send Message
                    </a>
                </div>
                 
             </div> 
               
          </div>
    </div>        
   <div class="tabs-animation">
    <div class="row">
        <div class="container mt-3">
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link active" data-toggle="tab" href="#details">Details</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#favs">Favorites</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#history">History</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#watch">Watch later</a>
                </li>
            </ul>
            
            <!-- Tab panes -->
            <div class="tab-content">
                <div id="details" class="container tab-pane active"><br>
                    <div class="col-md-12">
                        <div class="main-card mb-3 card">
                            <div class="table-responsive">
                                <table class="align-middle mb-0 table table-borderless table-striped table-hover">
                                    <tr>
                                        <th class="">Title</th>
                                        <td class=""><%= user.title %></td>
                                    </tr>
                                    <tr>
                                        <th class="">First Name</th>
                                        <td class=""><%= user.firstname %></td>
                                    </tr>
                                    <tr>
                                        <th class="">Last name</th>
                                        <td class=""><%= user.lastname %></td>
                                    </tr>
                                    <tr>
                                        <th class="">Middle Name</th>
                                        <td class=""><%= user.middlename %></td>
                                    </tr>
                                    <tr>
                                        <th class="">Email</th> 
                                        <td class=""><%= user.email %></td>
                                    </tr>
                                    <tr>
                                        <th class="">Address</th>
                                        <td class=""><%= user.address %></td>
                                    </tr>
                                  
                                    <tr>
                                        <th class="">Location</th>
                                        <td class=""><%= user.location %></td>
                                    </tr>
                                    <tr>
                                        <th class="">State of Origin</th>
                                        <td class=""><%= user.stateOfOrigin %></td>
                                    </tr>
                                    <tr>
                                        <th class="">LGA</th>
                                        <td class=""><%= user.LGA %></td>
                                    </tr>
                                    <tr>
                                        <th class="">Resident Pastor</th>
                                        <td class=""><%= user.residentPastor %></td>
                                    </tr>
                                    <tr>
                                        <th class="">Chapter Location</th>
                                        <td class=""><%=  user.chapterLocation %></td>
                                    </tr>
                                    <tr>
                                        <th class="">Organization Name</th>
                                        <td class=""><%= user.organisationName %></td>
                                    </tr>
                                    <tr>
                                        <th class="">favorites</th>
                                        <td class="">
                                            <div class="widget-content p-0">
                                                <div class="widget-content-wrapper">
                                                    <% favorites.forEach((favorite) =>{ %> 
                                                    <div class="widget-content-left mr-3">
                                                        <div class="widget-content-left">
                                                            <img width="40" class=" thumbnail" src="/small_images/<%= favorite.video.image %>" alt="">
                                                        </div>
                                                    </div>
                                                    <div class="widget-content-left flex2">
                                                        <div class="widget-heading">
                                                            <%= favorite.video.title %>
                                                        </div>
                                                    </div>
                                                    <% }) %> 
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                   
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="favs" class="container tab-pane fade"><br>
                    <div class="col-md-12">
                        <div class="main-card mb-3 card">
                            <div class="table-responsive">
                                <table class="align-middle mb-0 table table-borderless table-striped table-hover">
                                    <tr>
                                        <th>Video</th>
                                        <th>Date added</th>
                                    </tr>
                                    <% favorites.forEach((favorite, index) =>{ %> 
                                    <tr>
                                        <td class="">
                                            <div class="widget-content p-0">
                                                <div class="widget-content-wrapper">
                                                    <div class="widget-content-left mr-3">
                                                        <div class="widget-content-left">
                                                            <img width="40" class=" thumbnail" src="/small_images/<%= favorite.video.image %>" alt="">
                                                        </div>
                                                    </div>
                                                    <div class="widget-content-left flex2">
                                                        <div class="widget-heading">
                                                            <%= favorite.video.title %>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td> <%= moment(favorite.addedOn).format('LLL') %> </td>
                                    </tr>
                                    <% }) %> 
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="history" class="container tab-pane fade"><br>
                    <div class="col-md-12">
                        <div class="main-card mb-3 card">
                            <div class="table-responsive">
                                <table class="align-middle mb-0 table table-borderless table-striped table-hover">
                                    <tr>
                                        <th>Video</th>
                                        <th>Date added</th>
                                    </tr>
                                    <% history.forEach((history) =>{ %> 
                                    <tr>
                                        <td class="">
                                            <div class="widget-content p-0">
                                                <div class="widget-content-wrapper">
                                                    <div class="widget-content-left mr-3">
                                                        <div class="widget-content-left">
                                                            <img width="40" class=" thumbnail" src="/small_images/<%= history.video.image %>" alt="">
                                                        </div>
                                                    </div>
                                                    <div class="widget-content-left flex2">
                                                        <div class="widget-heading">
                                                            <%= history.video.title %>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td> <%= moment(history.addedOn).format('LLL') %> </td>
                                    </tr>
                                    <% }) %> 
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="watch" class="container tab-pane fade"><br>
                    <div class="col-md-12">
                        <div class="main-card mb-3 card">
                            <div class="table-responsive">
                                <table class="align-middle mb-0 table table-borderless table-striped table-hover">
                                    <tr>
                                        <th>Video</th>
                                        <th>Date added</th>
                                    </tr>
                                    <% watch.forEach((watch, index) =>{ %> 
                                    <tr>
                                        <td class="">
                                            <div class="widget-content p-0">
                                                <div class="widget-content-wrapper">
                                                    <div class="widget-content-left mr-3">
                                                        <div class="widget-content-left">
                                                            <img width="40" class=" thumbnail" src="/small_images/<%= watch.video.image %>" alt="">
                                                        </div>
                                                    </div>
                                                    <div class="widget-content-left flex2">
                                                        <div class="widget-heading">
                                                            <%= watch.video.title %>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td><%= moment(watch.addedOn).format('LLL') %> </td>
                                    </tr>
                                    <% }) %> 
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    
        
    </div>
  </div>
</div>
<!-- Page Content END -->

<%- include('../footer'); -%>
<%- include('../js'); -%>
<script>
$(document).on('click', '.btn-danger', function(e) {
    e.preventDefault();
    const id = $(this).attr('id');
    swal({
        title: 'Are you sure?',
        text: "This user will be blocked!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, proceed & Block!'
    }).then((result) => {
        if (result) {
            $.ajax({
                url: '/admin/block/'+id,
                method: "PUT",
                dataType : "json",
                "contentType": "application/json",
                success: function(data) {
                    window.location.reload();
                    if (data.status == 200) {
                        $('#success_message').html(data.message);
                    }
                },
                error: function(jqXhr) {
                    if (jqXhr.status == 400) {
                       
                    }
                }
            });
            swal(
                'Blocked!',
                'User has been Blocked.',
                'success'
            )

        }
    })
});


$(document).on('click', '.btn-info', function(e) {
    e.preventDefault();
    const id = $(this).attr('id');
    swal({
        title: 'Are you sure?',
        text: "This user will be unblocked!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, proceed & Block!'
    }).then((result) => {
        if (result) {
            $.ajax({
                url: '/admin/unblock/'+id,
                method: "PUT",
                dataType : "json",
                "contentType": "application/json",
                success: function(data) {
                    window.location.reload();
                    if (data.status == 200) {
                        $('#success_message').html(data.message);
                    }
                },
                error: function(jqXhr) {
                    if (jqXhr.status == 400) {
                    }
                }
            });
            swal(
                'Unblocked!',
                'User has been unblocked.',
                'success'
            )

        }
    })
});
</script>

<%- include('../../end'); -%>