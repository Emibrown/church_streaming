<%- include('../header'); -%>
<%- include('../sidebar'); -%>

<!-- Page Content  -->
<div class="app-main__inner">
    <!-- title  -->
   <div class="app-page-title">
       <div class="page-title-wrapper">
           <div class="page-title-heading">
               <div class="page-title-icon">
                   <i class="pe-7s-car icon-gradient bg-mean-fruit"></i>
               </div>
               <div>
                  Social Media Details
               </div>
           </div>
         </div>
   </div>       
   <!-- title -->
    <!--body  -->
    <div class="main-card mb-3 card">
        <div class="card-body">
            <table style="width: 100%;" id="example" class="table table-hover table-striped table-bordered">
                <thead>
                <tr>
                    <th>firstname</th>
                    <th>lastname</th>
                    <th>email</th>
                    <th>address</th>
                    <th>location</th>
                    <th>Block</th>
                    <th>View</th>
                    

                </tr>
                </thead>
                <tbody>
                    <% if(users.length > 0) { %>
                        <% users.forEach(user => { %>               
                 <tr>
                    <td><%= user.firstname %> </td>
                    <td><%= user.lastname %></td>
                    <td><%= user.email %></td>
                    <td><%= user.address %></td>
                    <td><%= user.location %></td>
                    <td>
                        <% if(user.isBlocked){ %>
                        <button id = "<%=user._id %>" class="mb-2 mr-2 btn-hover-shine btn btn-shadow btn-info"><i class="fas fa-check"></i></i> unblock user</button>
                        <% }else{ %>
                          <button id = "<%=user._id %>" class="mb-2 mr-2 btn-hover-shine btn btn-shadow btn-danger"><i class = "fas fa-trash-alt"></i> Block user</button>
                        <% } %>
                    </td>
                    <td>
                        <a href = "view-single/<%=user._id %>" class="mb-2 mr-2 btn-hover-shine btn btn-shadow btn-success"><i class="far fa-eye"></i> View record</a>
                    </td>
                </tr>
            <% }) %>
            <% }else{ %>
                No Record available
            <% } %>
                </tfoot>
            </table>
        </div>
    </div>
  <!-- body ends -->
</div>
<!-- Page Content END -->


<%- include('../footer'); -%>
<%- include('../js'); -%>
<script>
    $(document).on('submit', '#social_media', event => {
        event.preventDefault();
        const data = {
            "facebookHandle": $("#facebook_handle").val(),
            "instagramHandle": $("#instagram_handle").val(),
            "twitterHandle":  $("#twitter_handle").val(),
            "vimeoHandle": $("#vimeo_handle").val(),
            "googleplusHandle": $("#google_handle").val(),
         }
         
        jQuery.ajax({
        url: '/admin/settings',
        method: "PUT",
        dataType : "json",
        data: JSON.stringify(data),
        "contentType": "application/json",
        success: function(response) { 
            console.log(response);
            if(response.status==200){
            displaymsg(response.message, "alert-secondary")
            $('#social_media')[0].reset();
            }
          },
          error:function(jqXhr){
              if(jqXhr.status ==400){
                let responseText = jQuery.parseJSON(jqXhr.responseText);
                console.log(responseText)
              }
          }
      });
     })

    $(document).on('click', '.btn-danger', function(e) {
    e.preventDefault();
    const id = $(this).attr('id');
    jQuery.ajax({
        url: '/admin/blockUser',
        method: "PUT",
        dataType : "json",
        data: JSON.stringify({id}),
        "contentType": "application/json",
        success: function(response) { 
            console.log(response);
            if(response.status==200){
            displaymsg(response.message, "alert-secondary")
            }
          },
          error:function(jqXhr){
              if(jqXhr.status ==400){
                let responseText = jQuery.parseJSON(jqXhr.responseText);
                console.log(responseText)
              }
          }
      });

   
});
</script>
<%- include('../../end'); -%>